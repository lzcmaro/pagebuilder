function bindSubmitEvents(){$("form").each(function(){$("input[type=submit]",$(this)).unbind("click").one("click",function(){getQueryParameter("isPreview")==="true"||getSubmitData(this)}).bind("click",function(){return!1})})}function onClicked(e){$(e).one("click",function(){getQueryParameter("isPreview")==="true"||getSubmitData(this)})}function getSubmitData(e){var t=$(e).parents("div[data-role=page]"),n=$(e).parents("form"),r=[];if(_check(e)==0){alert("请填写调查问卷内容"),onClicked(e);return}$("div[data-role=fieldcontain]",t).each(function(){var e=$(this),t=$(".ui-controlgroup-label",e),n=$(".ui-input-text",e),i=$(".ui-select",e),s={question:null,ask:[]};if(t.length>0)s.question=e.find(".ui-controlgroup-label legend").html(),e.find("input").each(function(){var e=$(this);($("label[for="+e.attr("id")+"]").hasClass("ui-radio-on")||$("label[for="+e.attr("id")+"]").hasClass("ui-checkbox-on"))&&s.ask.push({type:e.attr("type"),name:e.attr("name"),isChecked:e.attr("type")=="radio"?$("label[for="+e.attr("id")+"]").hasClass("ui-radio-on")?"1":"0":$("label[for="+e.attr("id")+"]").hasClass("ui-checkbox-on")?"1":"0",value:$("label[for="+e.attr("id")+"] span.ui-btn-text").html()})});else if(n.length>0)s.question=e.find(".ui-input-text").html(),e.find("input,textarea").each(function(){var e=$(this);s.ask.push({type:e.attr("type")?e.attr("type"):"textarea",name:e.attr("name"),isChecked:"1",value:e.val()})});else if(i.length>0){s.question=e.find(".ui-select").html();var o=e.find("select").attr("data-native-menu");o==="false"?s.ask.push({type:"select",name:e.find("select").attr("name"),isChecked:"1",value:e.find(".ui-select span.ui-btn-text").text()}):e.find("select option").each(function(){var e=$(this);e.is(":selected")&&s.ask.push({type:"select",name:e.parent().attr("name"),isChecked:e.is(":selected")?"1":"0",value:e.text()})})}r.push(s)});var i=getPostUrl(),s=n.attr("action"),o=i+"&json="+encodeURI(JSON.stringify(r).replace(/&/g,"＆"));return submitForm(s,o,e),!1}function getPostUrl(){var e="",t=location.search;if(t.length>=1){var n=t.indexOf("?");n==0&&(t=t.substring(1));var r=t.split("&"),i=null,s=0,o="",u="";for(var a=0;a<r.length;a++)s=r[a].indexOf("="),o=r[a].substring(0,s+1),u=r[a].substring(s+1),e!=""&&(e+="&"),e+=o+encodeURIComponent(u)}var f=getFileName(location.pathname);return e!=""&&(e+="&"),e+="fileName="+f,e}function _check(e){var t=$(e).parents("form"),n=!1;return $("input[type=radio]",t).each(function(){$(this).is(":checked")&&(n=!0)}),$("select option",t).each(function(){$(this).is(":selected")&&(n=!0)}),$("textarea",t).each(function(){$.trim($(this).val())!=""&&(n=!0)}),$("input[type=text]",t).each(function(){$.trim($(this).val())!=""&&(n=!0)}),$("input[type=password]",t).each(function(){$.trim($(this).val())!=""&&(n=!0)}),n?!0:!1}function submitForm(e,t,n){Ajax.request(e,{method:"POST",data:t+"&pageAccessId="+pageAccessId,success:function(e){var t=JSON.parse(e),n=t.errorCode,r=t.errorMsg,i=t.contextPath;showErrorPage(n,r,i)},failure:function(e){onClicked(n)}})}function showErrorPage(e,t,n){e==0?document.location=n+"/html/surveyresult.html":e==1002?document.location=n+"/html/invalidpage.html":e==1003?document.location=n+"/html/doublesubmit.html":e==-1&&alert("未知异常，请联系管理员!")}function getProjectName(e){return"/"+e.split("/")[3]}function getFileName(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("."),r="";return t<n?r=e.substring(t+1,n):r="",r}function getPageAccess(){var e=getProjectName(location.href),t=e+"/pageAccessAction.action",n=getPostUrl();Ajax.request(t,{method:"POST",data:n,success:function(e){var t=JSON.parse(e),n=t.result,r=t.contextPath;n==1&&(pageAccessId=t.pageAccessId)},failure:function(e){}})}function getQueryParameter(e){var t=location.href,n="";t=t.replace("?","?&").split("&");for(var r=1;r<t.length;r++)t[r].indexOf(e+"=")==0&&(n=t[r].replace(e+"=",""));return n}function subscribe(){}var pageAccessId="";Ajax=function(){function e(e,n){function r(){}var i=n.async!==!1,s=n.method||"GET",o=n.data||null,u=n.success||r,a=n.failure||r;s=s.toUpperCase(),s=="GET"&&o&&(e+=(e.indexOf("?")==-1?"?":"&")+o,o=null);var f=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return f.onreadystatechange=function(){t(f,u,a)},f.open(s,e,i),s=="POST"&&f.setRequestHeader("Content-type","application/x-www-form-urlencoded;"),f.send(o),f}function t(e,t,n){if(e.readyState==4){var r=e.status;r>=200&&r<300?t(e.responseText):n(e.responseText)}}return{request:e}}(),$(function(){$("a[data-role=button], div[data-role=navbar] a").bind("click",function(){var e=$(this).attr("data-transition"),t=$(this).attr("href"),n=$(this).parents("div[data-role=page]"),r="ui-page-active",i="ui-btn-active";n.removeClass(r),$(t).addClass(r);if($(this).hasClass(i))return;$(".ui-btn-active").removeClass(i),$(this).addClass(i)}),$("ul[data-role=listview] li.ui-btn").bind("click",function(){$(this).parents("div[data-role=page]").removeClass("ui-btn-active"),$(".ui-btn-active").removeClass("ui-btn-active"),$(this).addClass("ui-btn-active")}),$("ul[data-role=listview] li.ui-btn a,a.ui-link").bind("click",function(){var e=$(this).attr("href"),t=$(this).parents("div[data-role=page]"),n="ui-page-active";t.removeClass(n),$(e).addClass(n)}),$("label[for*=radio]").bind("click",function(){var e="ui-icon-radio-on",t="ui-icon-radio-off",n="ui-btn-active",r=$(this).parents("fieldset").attr("data-type"),i=$(this).parent().parent().find("label[for*=radio]"),s=i.children().find(".ui-icon");i.attr("data-icon","radio-off"),$(this).attr("data-icon","radio-on"),r=="horizontal"?(i.removeClass("ui-radio-on").removeClass(n),$(this).toggleClass("ui-radio-on").toggleClass(n)):(i.removeClass("ui-radio-on"),$(this).toggleClass("ui-radio-on")),s.removeClass(e),s.addClass(t),$(this).children().find(".ui-icon").removeClass(t).addClass(e)}),$("select").bind("change",function(){$(this).siblings().children().find("span").text($(this).find("option:selected").text())}),$(".ui-select a").bind("click",function(){var e=$(this).attr("id"),t=e.substring(0,e.length-6)+"listbox",n=$(this).width()/2-$("#"+t+"-popup").width()/2,r=$(this).offset().top;return $("#"+t+"-popup").css({left:n,top:r}).removeClass("ui-popup-hidden").addClass("ui-popup-active"),$("#"+t+"-screen").removeClass("ui-screen-hidden").addClass("in"),!1}),$(".ui-popup-screen").bind("click",function(){var e=$(this).attr("id"),t=e.substring(0,e.length-7);$(this).removeClass("in").addClass("ui-screen-hidden"),$("#"+t+"-popup").removeAttr("style").removeClass("ui-popup-active").addClass("ui-popup-hidden")}),$(".ui-selectmenu-list li a").bind("click",function(){var e=$(this).text(),t=$(this).closest("ul").parent().attr("id"),n=$(this).closest("ul").attr("id");return $(".ui-selectmenu-list li",$("#"+t+"-popup")).removeClass("ui-btn-active"),$(this).closest("li").addClass("ui-btn-active"),$("#"+t+"-popup").removeAttr("style").removeClass("ui-popup-active").addClass("ui-popup-hidden"),$("#"+t+"-screen").removeClass("in").addClass("ui-screen-hidden"),$("a[aria-owns="+n+"] span span.ui-btn-text").text(e),!1}),$("label[for*=checkbox]").bind("click",function(){var e="ui-icon-checkbox-on",t="ui-icon-checkbox-off",n="ui-btn-active",r=$(this).parents("fieldset").attr("data-type"),i=$(this).children().find(".ui-icon");$(this).attr("data-icon")=="checkbox-on"?$(this).attr("data-icon","checkbox-off"):$(this).attr("data-icon","checkbox-on"),r=="horizontal"?$(this).toggleClass("ui-checkbox-on").toggleClass(n):$(this).toggleClass("ui-checkbox-on"),i.hasClass(t)?i.removeClass(t).addClass(e):i.removeClass(e).addClass(t)}),$("div[data-role=page]").bind("click",function(e){var t=$(this).find("div[data-role=footer]"),n=$(this).find("div[data-role=footer]").attr("data-position");n=="fixed"&&t.toggleClass("ui-fixed-hidden")})}),$(function(){bindSubmitEvents()}),$(window).load(function(){getQueryParameter("isPreview")!=="true"&&getPageAccess()})