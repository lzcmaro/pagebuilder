(function(a){a.extend(a.fn,{box:function(b){return this.each(function(){var c=a.data(this,"box");if(!c){c=new a.box(b,this);a.data(this,"box",c)}})}});a.box=function(b,c){if(arguments.length){this._init(b,c)}};a.box.prototype={isOpen:false,options:{title:"Box",boxClass:"",height:"auto",width:"auto",position:false,modal:false,autoOpen:false,btnClose:false,effects:false,dragable:true},_init:function(b,c){this.options=a.extend(true,{},this.options,b),this.element=a(c),this._create(),this._bindEvents(),this.options.autoOpen&&this.open()},_create:function(){var c=this.options,b=this.element;this.box=a("<div />").hide().addClass("box").addClass(c.boxClass).appendTo("body");c.title!==false&&(this.header=a("<div />").addClass("box-header").append(a("<div />").addClass("box-title").html(c.title)).appendTo(this.box));this.content=a("<div />").addClass("box-content").css({height:c.height,width:c.width}).append(b.show()).appendTo(this.box),this.iframe=a("<iframe frameborder='0' border='0' />").addClass("lay").appendTo(this.box),c.modal===true&&this._createOverlay(),this._trigger("create")},_createOverlay:function(){if(this.overlay){return}this.overlay=a("<div />").hide().addClass("box-overlay").css({width:this._docWidth(),height:this._docHeight()}).append("<div class='back' /><iframe frameborder='0' border='0' class='lay' />").appendTo("body")},_bindEvents:function(){var b=this,c=this.options;a(window).bind("resize",function(){c.modal===true&&b.overlay.css({width:b._docWidth(),height:b._docHeight()}),b._position(c.position)});if(c.btnClose){if(typeof(c.btnClose)=="object"){a(c.btnClose).click(function(){b.close()})}else{if(typeof(c.btnClose)=="string"){a("#"+c.btnClose).click(function(){b.close()})}}}if(c.dragable===true){b.header&&(b.header.addClass("box-unselect"),b._dragable())}else{if(typeof c.dragable==="string"||typeof c.dragable==="object"){b.header&&b.header.hide(),b.header=(typeof c.dragable.html==="function"?c.dragable:a(c.dragable)),b.header.addClass("box-unselect"),b._dragable()}}},_dragable:function(){var e=this.header,k=this.box,j,l=false,i,g,b=function(c){l=true;var d=k.offset();i=d.left;g=d.top;j={maxX:a(document).width()-k.width(),maxY:a(document).height()-k.height(),posX:c.clientX-i,posY:c.clientY-g}},m=function(c){if(l){k.css({left:Math.max(0,Math.min(c.clientX-j.posX,j.maxX))+"px",top:Math.max(0,Math.min(c.clientY-j.posY,j.maxY))+"px"})}},f=function(){l=false};e.mousedown(b);a(document).mousemove(m).mouseup(f);e.undraggable=function(){e.unbind("mousedown",b);a(document).unbind("mousemove",m).unbind("mouseup",f);delete e.undraggable;b=f=m=null;return this}},open:function(){if(this.isOpen){return}var b=this,c=this.options;b._position(c.position),c.modal===true&&b.overlay.show(),c.effects?b._doEffects("open"):b.box.show(),b._trigger("open"),b.isOpen=true},close:function(){if(!this.isOpen){return}var b=this,c=this.options;c.effects?b._doEffects("close"):b.box.hide(),b.overlay&&b.overlay.hide(),b._trigger("close"),b.isOpen=false},_doEffects:function(b){"open"==b?this.box.show("slow"):this.box.hide("slow")},_docHeight:function(){var c,b;if(a.browser.msie&&a.browser.version<7){c=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);b=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(c<b){return a(window).height()+"px"}else{return c+"px"}}else{return a(document).height()+"px"}},_docWidth:function(){var b,c;if(a.browser.msie){b=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);c=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(b<c){return a(window).width()+"px"}else{return b+"px"}}else{return a(document).width()+"px"}},_position:function(b){this.box.css({left:b&&b.left||(a(document).width()-this.box.width())/2,top:b&&b.top||(document.documentElement.clientHeight-this.box.height())/2+a(document).scrollTop()})},_trigger:function(b,c,d){var g,f,e=this.options[b];d=d||{};c=a.Event(c);c.type=(b===this.eventPrefix?b:this.eventPrefix+b).toLowerCase();c.target=this.element[0];f=c.originalEvent;if(f){for(g in f){if(!(g in c)){c[g]=f[g]}}}this.element.trigger(c,d);return !(a.isFunction(e)&&e.call(this.element[0],c,d)===false||c.isDefaultPrevented())}};a.extend(a.fn,{open:function(){a(this).data("box")&&a(this).data("box").open()},close:function(){a(this).data("box")&&a(this).data("box").close()}})})(jQuery);
