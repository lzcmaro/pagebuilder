//     keymaster.js
//     (c) 2011 Thomas Fuchs
//     keymaster.js may be freely distributed under the MIT license.
(function(c){var g,f={},l={16:false,18:false,17:false,91:false},d="all",a={"\u21e7":16,shift:16,option:18,"\u2325":18,alt:18,ctrl:17,control:17,command:91,"\u2318":91},m={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34};for(g=1;g<20;g++){a["f"+g]=111+g}function j(s){var q,p,r,n,o,t;p=(s.target||s.srcElement).tagName;q=s.keyCode;if(q==93||q==224){q=91}if(q in l){l[q]=true;for(n in a){if(a[n]==q){b[n]=true}}return}if(p=="INPUT"||p=="SELECT"||p=="TEXTAREA"){return}if(!(q in f)){return}for(o=0;o<f[q].length;o++){r=f[q][o];if(r.scope==d||r.scope=="all"){t=r.mods.length>0;for(n in l){if((!l[n]&&r.mods.indexOf(+n)>-1)||(l[n]&&r.mods.indexOf(+n)==-1)){t=false}}if((r.mods.length==0&&!l[16]&&!l[18]&&!l[17]&&!l[91])||t){if(r.method(s,r)===false){if(s.preventDefault){s.preventDefault()}else{s.returnValue=false}if(s.stopPropagation){s.stopPropagation()}if(s.cancelBubble){s.cancelBubble=true}}}}}}function e(p){var o=p.keyCode,n;if(o==93||o==224){o=91}if(o in l){l[o]=false;for(n in a){if(a[n]==o){b[n]=false}}}}function b(o,p,s){var r,q,n,k;if(s===undefined){s=p;p="all"}o=o.replace(/\s/g,"");r=o.split(",");for(n=0;n<r.length;n++){q=[];o=r[n].split("+");if(o.length>1){q=o.slice(0,o.length-1);for(k=0;k<q.length;k++){q[k]=a[q[k]]}o=[o[o.length-1]]}o=o[0];o=o.length>1?m[o]:o.toUpperCase().charCodeAt(0);if(!(o in f)){f[o]=[]}f[o].push({shortcut:r[n],scope:p,method:s,key:r[n],mods:q})}}for(g in a){b[g]=false}function i(k){d=k||"all"}function h(k,n,o){if(k.addEventListener){k.addEventListener(n,o,false)}else{if(k.attachEvent){k.attachEvent("on"+n,function(){o(window.event)})}}}h(document,"keydown",j);h(document,"keyup",e);c.key=b;c.key.setScope=i;if(typeof module!=="undefined"){module.exports=key}})(this);
